function rgba2Color(f,e,c,d){return f<<24|e<<16|c<<8|d}function NinePatch(c,b){this.div=c;this.padding={top:0,left:0,right:0,bottom:0};const a=this;this.bgImage=new Image();this.bgImage.onload=function(){a.originalBgColor=a.div.css("background-color");if(a.originalBgColor==="none"){a.originalBgColor=""}a.div.css("background","none");let tempCanvas=document.createElement("canvas");tempCanvas.width=a.bgImage.width;tempCanvas.height=a.bgImage.height;let tempCtx=tempCanvas.getContext("2d");tempCtx.drawImage(a.bgImage,0,0);let data=tempCtx.getImageData(0,0,a.bgImage.width,1).data;const f=rgba2Color(data[0],data[1],data[2],data[3]);const g=rgba2Color(data[data.length-4],data[data.length-3],data[data.length-2],data[data.length-1]);a.horizontalPieces=a.getPieces(data.slice(4,data.length-4),f,g);data=tempCtx.getImageData(0,1,1,a.bgImage.height-2).data;a.verticalPieces=a.getPieces(data,f,g);data=tempCtx.getImageData(a.bgImage.width-1,0,1,a.bgImage.height).data;const e=a.getBorderPadding(data,a.verticalPieces);a.padding.top=e.begin;a.padding.bottom=e.end;data=tempCtx.getImageData(0,a.bgImage.height-1,a.bgImage.width,1).data;const d=a.getBorderPadding(data,a.horizontalPieces);a.padding.left=d.begin;a.padding.right=d.end;if(a.horizontalPieces.length===3&&a.verticalPieces.length===3&&a.horizontalPieces[0][0]==="s"&&a.horizontalPieces[1][0]!=="s"&&a.horizontalPieces[2][0]==="s"&&a.verticalPieces[0][0]==="s"&&a.verticalPieces[1][0]!=="s"&&a.verticalPieces[2][0]==="s"){a.drawCSS3()}else{a.draw();a.div.on("resize",a.draw)}};this.bgImage.src=b}NinePatch.prototype.div=null;NinePatch.prototype.padding=null;NinePatch.prototype.originalBgColor=null;NinePatch.prototype.horizontalPieces=null;NinePatch.prototype.verticalPieces=null;NinePatch.prototype.bgImage=null;NinePatch.prototype.getPieces=function(c,a,d){const b=[];let curColor=rgba2Color(c[0],c[1],c[2],c[3]);let preType=(curColor===a?"s":(curColor===d?"r":"d"));let start=1;let curType,width,i,curPos;for(i=4;i<c.length;i+=4){curPos=i/4+1;curColor=rgba2Color(c[i],c[i+1],c[i+2],c[i+3]);curType=(curColor===a?"s":(curColor===d?"r":"d"));if(preType!==curType){width=curPos-start;b.push([preType,start,width]);preType=curType;start=curPos}}width=curPos-start+1;b.push([preType,start,width]);return b};NinePatch.prototype.getBorderPadding=function(c,e){const d=rgba2Color(c[0],c[1],c[2],c[3]);const f={begin:0,end:0};const b=4;const a=c.length-8;let i,curColor;let foundPadIndex=false;for(i=b;i<=a;i+=4){curColor=rgba2Color(c[i],c[i+1],c[i+2],c[i+3]);if(curColor!==d){foundPadIndex=true;break}}if(foundPadIndex){f.begin=i/4-1}else{f.begin=e[0][2];f.end=e[e.length-1][2];return f}for(i=a;i>=b;i-=4){curColor=rgba2Color(c[i],c[i+1],c[i+2],c[i+3]);if(curColor!==d){break}}f.end=(a-i)/4;return f};NinePatch.prototype.draw=function(){if(this.horizontalPieces===null||this.verticalPieces===null){return}const c=document.createElement("canvas");c.width=this.div.width()+this.padding.left+this.padding.right;c.height=this.div.height()+this.padding.top+this.padding.bottom;const a=c.getContext("2d");let staticWidth=0;let stretchCount=0;let i;for(i=0;i<this.horizontalPieces.length;i++){if(this.horizontalPieces[i][0]==="s"){staticWidth+=this.horizontalPieces[i][2]}else{stretchCount++}}const e=stretchCount>0?(c.width-staticWidth)/stretchCount:0;let staticHeight=0;stretchCount=0;for(i=0;i<this.verticalPieces.length;i++){if(this.verticalPieces[i][0]==="s"){staticHeight+=this.verticalPieces[i][2]}else{stretchCount++}}const d=stretchCount>0?(c.height-staticHeight)/stretchCount:0;let fillWidth,fillHeight,tempCanvas,tempCtx;for(i=0;i<this.verticalPieces.length;i++){for(let j=0;j<this.horizontalPieces.length;j++){fillWidth=(this.horizontalPieces[j][0]==="d")?e:this.horizontalPieces[j][2];fillHeight=(this.verticalPieces[i][0]==="d")?d:this.verticalPieces[i][2];if(this.verticalPieces[i][0]!=="r"){a.drawImage(this.bgImage,this.horizontalPieces[j][1],this.verticalPieces[i][1],this.horizontalPieces[j][2],this.verticalPieces[i][2],0,0,fillWidth,fillHeight)}else{tempCanvas=document.createElement("canvas");tempCanvas.width=this.horizontalPieces[j][2];tempCanvas.height=this.verticalPieces[i][2];tempCtx=tempCanvas.getContext("2d");tempCtx.drawImage(this.bgImage,this.horizontalPieces[j][1],this.verticalPieces[i][1],this.horizontalPieces[j][2],this.verticalPieces[i][2],0,0,this.horizontalPieces[j][2],this.verticalPieces[i][2]);a.fillStyle=a.createPattern(tempCanvas,"repeat");a.fillRect(0,0,fillWidth,fillHeight)}a.translate(fillWidth,0)}a.translate(-c.width,(this.verticalPieces[i][0]==="s"?this.verticalPieces[i][2]:d))}const b=c.toDataURL("image/png");this.div.css("background",this.originalBgColor+" url("+b+") no-repeat");this.div.css("padding-left",this.padding.left);this.div.css("padding-right",this.padding.right);this.div.css("padding-top",this.padding.top);this.div.css("padding-bottom",this.padding.bottom)};NinePatch.prototype.drawCSS3=function(){const d=document.createElement("canvas");d.width=this.bgImage.width-2;d.height=this.bgImage.height-2;const a=d.getContext("2d");a.drawImage(this.bgImage,-1,-1);const c=d.toDataURL("image/png");const b=this.padding.top+"px "+this.padding.right+"px "+this.padding.bottom+"px "+this.padding.left+"px";const e=b.replaceAll("px","");this.div.css("border-width",b);this.div.css("border-style","solid");this.div.css("padding","0");this.div.css("border-image","url("+c+") "+e+" fill "+(this.horizontalPieces[1][1]==="r"?"repeat":"stretch")+" "+(this.verticalPieces[1][1]==="r"?"repeat":"stretch"))};window.NinePatch=NinePatch;$(function(){$("*").each(function(){const b=$(this);const a=b.css("background-image").match(/\(\s*['"](.*?\.9\.(?:png|gif))['"]\s*\)/i);if(a){new NinePatch(b,a[1])}})});